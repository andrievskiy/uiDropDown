{"version":3,"sources":["dom/element.js","template/template.js","_uiDropDownParts.js","_uiDropDownUsersMatcher.js","uiDropDownWidget.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ui-drop-down.js","sourcesContent":["/**\r\n * Модуль для работы с DOM\r\n */\r\n(function (window) {\r\n    'use strict';\r\n\r\n    /**\r\n     * @param selectorOrElement {String | HtmlElement}\r\n     * @returns {_UiElement}\r\n     * @constructor\r\n     */\r\n    function UiElement(selectorOrElement) {\r\n        return new _UiElement(selectorOrElement);\r\n    }\r\n\r\n    /**\r\n     * Create new DOM element and wrap to UiElement\r\n     * @param tagName\r\n     * @returns {_UiElement}\r\n     */\r\n    UiElement.create = function (tagName) {\r\n        return new _UiElement(document.createElement(tagName));\r\n    };\r\n\r\n\r\n    /**\r\n     * Класс враппера для работы с DOM елементами\r\n     * @param selectorOrElement\r\n     * @private\r\n     */\r\n    function _UiElement(selectorOrElement) {\r\n        this.element = null;\r\n        if (typeof selectorOrElement == \"string\") {\r\n            this.element = document.querySelector(selectorOrElement);\r\n        }\r\n        if (selectorOrElement instanceof HTMLElement) {\r\n            this.element = selectorOrElement;\r\n        }\r\n        if(this.element === null){\r\n            console.error('Invalid or unsupported selector or dom element: ' + selectorOrElement);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Расчет координат относительно документа, учитывая clientTop/clientLeft\r\n     * @returns {{top: number, left: number}}\r\n     */\r\n    _UiElement.prototype.getCoordinates = function () {\r\n        var byWindow = this.element.getBoundingClientRect();\r\n        var bodyElement = document.body;\r\n        var documentElement = document.documentElement;\r\n\r\n        var scrollTop = window.pageYOffset || documentElement.scrollTop || bodyElement.scrollTop;\r\n        var scrollLeft = window.pageXOffset || documentElement.scrollLeft || bodyElement.scrollLeft;\r\n\r\n        var clientTop = documentElement.clientTop || bodyElement.clientTop || 0;\r\n        var clientLeft = documentElement.clientLeft || bodyElement.clientLeft || 0;\r\n\r\n        return {\r\n            top: byWindow.top + scrollTop - clientTop,\r\n            left: byWindow.left + scrollLeft - clientLeft\r\n        }\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {number}\r\n     */\r\n    _UiElement.prototype.clientLeft = function () {\r\n        return this.element.clientLeft;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {number}\r\n     */\r\n    _UiElement.prototype.clientRight = function () {\r\n        // @TODO: Поправить на корректную работу в случае скрола\r\n        var clientRight =  this.offsetWidth() - this.clientLeft() - this.clientWidth();\r\n        return clientRight;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {number}\r\n     */\r\n    _UiElement.prototype.clientTop = function () {\r\n        return this.element.clientTop;\r\n    };\r\n\r\n\r\n    /**\r\n     *\r\n     * @returns {number}\r\n     */\r\n    _UiElement.prototype.offsetWidth = function () {\r\n        return this.element.offsetWidth;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {number}\r\n     */\r\n    _UiElement.prototype.clientWidth = function () {\r\n        return this.element.clientWidth;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {number}\r\n     */\r\n    _UiElement.prototype.scrollWidth = function () {\r\n        return this.element.scrollWidth;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param cls\r\n     */\r\n    _UiElement.prototype.addClass = function (cls) {\r\n        this.element.classList.add(cls);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param cls\r\n     */\r\n    _UiElement.prototype.removeClass = function (cls) {\r\n      this.element.classList.remove(cls);\r\n    };\r\n\r\n    /**\r\n     * Обернуть элемент враппером\r\n     * @param wrapper {UiElement}\r\n     */\r\n    _UiElement.prototype.wrap = function (wrapper) {\r\n        var el, parent;\r\n        if(wrapper instanceof _UiElement){\r\n            el = wrapper.element;    \r\n        } else{\r\n            el = wrapper;\r\n        }\r\n\r\n        parent = this.element.parentNode;\r\n\r\n\r\n        if(this.element.nextSibling){\r\n            parent.insertBefore(el, this.element.nextSibling);\r\n        } else {\r\n            parent.appendChild(el);\r\n        }\r\n        el.appendChild(this.element);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param value\r\n     * @returns {*|string|Number}\r\n     */\r\n    _UiElement.prototype.val = function (value) {\r\n        if(value != undefined){\r\n            this.element.value = value;\r\n            return;\r\n        }\r\n        return this.element.value;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param eventKey\r\n     * @param callback\r\n     * @param stage\r\n     */\r\n    _UiElement.prototype.on = function (eventKey, callback, stage) {\r\n        this.element.addEventListener(eventKey, callback, stage);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param evenKey\r\n     * @param callback\r\n     * @param stage\r\n     */\r\n    _UiElement.prototype.off = function (evenKey, callback, stage) {\r\n        this.element.removeEventListener(evenKey, callback, stage);\r\n    };\r\n    /**\r\n     * Удалить потомка\r\n     * @param child\r\n     * @returns {Node}\r\n     */\r\n    _UiElement.prototype.removeChild =function (child) {\r\n        return this.element.removeChild(child);\r\n    };\r\n\r\n    /**\r\n     * Добаить потомка к элементу\r\n     * @param child\r\n     * @returns {Node}\r\n     */\r\n    _UiElement.prototype.append = function (child) {\r\n        if(child instanceof _UiElement){\r\n             return this.element.appendChild(child.element);\r\n        }\r\n        return this.element.appendChild(child);\r\n    };\r\n\r\n    _UiElement.prototype.html = function (val) {\r\n        if(val != undefined){\r\n            this.element.innerHTML = val;\r\n            return;\r\n        }\r\n        return this.element.innerHTML;\r\n    };\r\n\r\n    /**\r\n     * Прокси для проброса style\r\n     */\r\n    Object.defineProperties(_UiElement.prototype, {\r\n        style: {\r\n            get: function () {\r\n                return this.element.style;\r\n            }\r\n        }\r\n    });\r\n\r\n    window.UiElement = UiElement;\r\n\r\n})(window);","/**\r\n * Created by andrievskiy on 03.06.17.\r\n */\r\n;(function (window) {\r\n    function renderTemplate(template, data) {\r\n          return template.replace(/{(\\w+)}/g, function (match, key) {\r\n            return data[key] || '';\r\n        })\r\n    }\r\n\r\n    window.uiRenderTemplate = renderTemplate;\r\n})(window);","/**\r\n * Created by andrievskiy on 03.06.17.\r\n */\r\n;(function (window) {\r\n    var dropDownItemDefaultTemplate = '';\r\n\r\n    function DropDownItem(template, data, matchedBy) {\r\n        return new _DropDownItem(template, data, matchedBy);\r\n    }\r\n\r\n    function _DropDownItem(template, data, matchedBy) {\r\n        // TODO: Безопасный рендеринг\r\n        this.uiElement = UiElement.create('div');\r\n        this.uiElement.addClass('ui-drop-down-item-container');\r\n\r\n        this.template = template || dropDownItemDefaultTemplate;\r\n        this.data = data;\r\n        this.matchedBy = matchedBy;\r\n        this.name = this.data.name.replace(this.matchedBy, '<span class=\"highlight\">' + this.matchedBy + '</span>');\r\n    }\r\n    \r\n    _DropDownItem.prototype.render = function () {\r\n        var html = uiRenderTemplate(this.template, this);\r\n        this.uiElement.html(html);\r\n        return this.uiElement;\r\n    };\r\n\r\n    window.DropDownItem = DropDownItem;\r\n})(window);","(function (window) {\r\n    'use strict';\r\n    var LATIN_TO_CYRILLIC_KEYBOARD = {\r\n        'q': 'й',\r\n        'w': 'ц',\r\n        'e': 'у',\r\n        'r': 'к',\r\n        't': 'е',\r\n        'y': 'н',\r\n        'u': 'г',\r\n        'i': 'ш',\r\n        'o': 'щ',\r\n        'p': 'з',\r\n        '{': 'х',\r\n        '}': 'ъ',\r\n        'a': 'ф',\r\n        's': 'ы',\r\n        'd': 'в',\r\n        'f': 'а',\r\n        'g': 'п',\r\n        'h': 'р',\r\n        'j': 'о',\r\n        'k': 'л',\r\n        'l': 'д',\r\n        ';': 'ж',\r\n        \"'\": 'э',\r\n        'z': 'я',\r\n        'x': 'ч',\r\n        'c': 'с',\r\n        'v': 'м',\r\n        'b': 'и',\r\n        'n': 'т',\r\n        'm': 'ь',\r\n        ',': 'б',\r\n        '.': 'ю'\r\n    };\r\n    var CYRILLIC_TO_LATIN_KEYBOARD = {};\r\n\r\n    Object.keys(LATIN_TO_CYRILLIC_KEYBOARD).map(function (key) {\r\n        var k = LATIN_TO_CYRILLIC_KEYBOARD[key];\r\n        CYRILLIC_TO_LATIN_KEYBOARD[k] = key;\r\n    });\r\n\r\n\r\n    var LATIN_TO_CYRILLIC_FIRST_REPLACE_MAP = {\r\n        'yo': 'ё',\r\n        'zh': 'ж',\r\n        'kh': 'х',\r\n        'ts': 'ц',\r\n        'ch': 'ч',\r\n        'sch': 'щ',\r\n        'shch': 'щ',\r\n        'sh': 'ш',\r\n        'eh': 'э',\r\n        'yu': 'ю',\r\n        'ya': 'я',\r\n        \"'\": 'ь'\r\n    };\r\n\r\n    var CYRILLIC_TO_LATIN_FIRST_REPLACE_MAP = {};\r\n\r\n    Object.keys(LATIN_TO_CYRILLIC_FIRST_REPLACE_MAP).map(function (key) {\r\n        var k = LATIN_TO_CYRILLIC_FIRST_REPLACE_MAP[key];\r\n        CYRILLIC_TO_LATIN_FIRST_REPLACE_MAP[k] = key;\r\n    });\r\n\r\n    var MULTIPLE_LATIN_CHARTS = {\r\n        'y': ['ы', 'ё', 'ю', 'я'],\r\n        'z': ['ж', 'з'],\r\n        'k': ['х', 'к'],\r\n        't': ['ц', 'т'],\r\n        'c': ['ц', 'ч',  'щ'],\r\n        's': ['ш', 'щ', 'с'],\r\n        'e': ['е', 'э']\r\n    };\r\n\r\n    var LATIN_ALPHABET = 'abvgdezijklmnoprstufhcyABVGDEZIJKLMNOPRSTUFHCYёЁ';\r\n    var CYRILLIC_ALPHABET = 'абвгдезийклмнопрстуфхцыАБВГДЕЗИЙКЛМНОПРСТУФХЦЫеЕ';\r\n\r\n\r\n    function _toCyrillicKeyboard(str) {\r\n        var result = '';\r\n        var charts = str.split('');\r\n        charts.forEach(function (chart) {\r\n            result += LATIN_TO_CYRILLIC_KEYBOARD[chart] || chart;\r\n        });\r\n\r\n        return result;\r\n    }\r\n\r\n    function _toLatinKeyboard(str) {\r\n        var result = '';\r\n        var charts = str.split('');\r\n        charts.forEach(function (chart) {\r\n            result += CYRILLIC_TO_LATIN_KEYBOARD[chart] || chart;\r\n        });\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Получение всех возможных уникальных вариантов для поиска\r\n     *\r\n     * @param prefix\r\n     * @returns {Array}\r\n     * @private\r\n     */\r\n    function _getPrefixVariables(prefix) {\r\n        var variables = [];\r\n        var cyrillicKeyboard;\r\n        var latinKeyboard;\r\n\r\n        // Получение всех кирилических вариантов по латинице\r\n        // За счет того, что латиница уже, то одну строку на ней\r\n        // Можжно представить несколькими на кирилице\r\n        // Например: z = ж/z = з\r\n        variables = variables.concat(_latinToCyrillicVariants(prefix));\r\n\r\n        // Приведение кириллицы к латинице\r\n        // Например: юа => yoa\r\n        variables.push(_cyrillicToLatinVariants(prefix));\r\n\r\n\r\n        // Приведение расладок\r\n\r\n        cyrillicKeyboard = _toCyrillicKeyboard(prefix);\r\n        latinKeyboard = _toLatinKeyboard(prefix);\r\n        variables.push(cyrillicKeyboard);\r\n        variables.push(latinKeyboard);\r\n\r\n        // Транслитерация для раскладок\r\n        // Например: кщпщя -> rogoz -> рогоз\r\n        variables.push(_cyrillicToLatinVariants(cyrillicKeyboard));\r\n        variables = variables.concat(_latinToCyrillicVariants(latinKeyboard));\r\n\r\n        // Вывод уникальных валидаторов\r\n        // TODO: Оптимизироввать через set\r\n        variables = variables.filter(function (item, idx, array) {\r\n            return array.indexOf(item) === idx;\r\n        });\r\n\r\n        return variables;\r\n    }\r\n\r\n\r\n    function _latinToCyrillicVariants(str) {\r\n        var variants;\r\n        var charts;\r\n\r\n        // Сначала происходит замена \"букв\" из нескольких символов\r\n        Object.keys(LATIN_TO_CYRILLIC_FIRST_REPLACE_MAP).forEach(function (char) {\r\n           str = str.split(char).join(LATIN_TO_CYRILLIC_FIRST_REPLACE_MAP[char]);\r\n        });\r\n\r\n        charts = str.split('');\r\n\r\n        variants = _extendVariants(charts);\r\n        variants = variants.map(function (variant) {\r\n            return _replace(variant.join(''));\r\n        });\r\n\r\n        return variants;\r\n\r\n        /**\r\n         * Производит расширение вариантов для  символов соответствующих нескольким русским буквам\r\n         * при условии что символ находится в конце строки (т.е. невозиожно определить к чему он приводится)\r\n         * @param charts\r\n         * @returns {*[]}\r\n         * @private\r\n         */\r\n        function _extendVariants(charts) {\r\n            var variants = [charts];\r\n            var lastChart = charts[charts.length - 1];\r\n            var chartVariants;\r\n\r\n            if(MULTIPLE_LATIN_CHARTS[lastChart]){\r\n                variants = [];\r\n                chartVariants = MULTIPLE_LATIN_CHARTS[lastChart];\r\n                chartVariants.forEach(function (chartVar) {\r\n\r\n                    var newVariant = charts.slice(0, charts.length - 1);\r\n                    newVariant.push(chartVar);\r\n                    variants.push(newVariant);\r\n                });\r\n            }\r\n            return variants;\r\n        }\r\n\r\n        function _replace(str) {\r\n            for (var i = 0; i < LATIN_ALPHABET.length; i++) {\r\n                str = str.split(LATIN_ALPHABET.charAt(i)).join(CYRILLIC_ALPHABET.charAt(i));\r\n            }\r\n            return str;\r\n        }\r\n    }\r\n\r\n\r\n    function _cyrillicToLatinVariants(str) {\r\n        // Сначала происходит замена \"букв\" из нескольких символов\r\n        Object.keys(CYRILLIC_TO_LATIN_FIRST_REPLACE_MAP).forEach(function (char) {\r\n           str = str.split(char).join(CYRILLIC_TO_LATIN_FIRST_REPLACE_MAP[char]);\r\n        });\r\n\r\n        function _replace(str) {\r\n            for (var i = 0; i < CYRILLIC_ALPHABET.length; i++) {\r\n                str = str.split(CYRILLIC_ALPHABET.charAt(i)).join(LATIN_ALPHABET.charAt(i));\r\n            }\r\n            return str;\r\n        }\r\n        return _replace(str);\r\n    }\r\n\r\n\r\n    /**\r\n     * Производит сравнение по префиксу с учетом раскладок и транслитерации\r\n     * @param prefix {String}\r\n     * @param suggestion {Object}\r\n     * @param selectedSuggestions {Array}\r\n     * @param options {Object}\r\n     * @param options.byProperty {String} - свойтво по которму производится сравненение\r\n     * @param options.uidProperty {String} - свойтво уникальный идентификатор\r\n     * @returns {Object}\r\n     */\r\n    function uiDropDownUsersMatcher(prefix, suggestion, selectedSuggestions, options) {\r\n        // TODO: произветси оптимизацию поиска\r\n        options = options || { byProperty: 'name', uidProperty: 'uid' };\r\n\r\n        var result = {\r\n            matched: false,\r\n            matchedBy: null\r\n        };\r\n        var prefixes, suggestionParts, matched;\r\n\r\n        if(selectedSuggestions[suggestion[options.uidProperty]]){\r\n            return result;\r\n        }\r\n\r\n        prefix = prefix.trim().toLowerCase();\r\n\r\n        prefixes = _getPrefixVariables(prefix);\r\n\r\n        suggestionParts = suggestion[options.byProperty].split(' ');\r\n\r\n        suggestionParts.push(suggestion[options.byProperty]);\r\n\r\n        matched = suggestionParts.some(function (part) {\r\n            var originalPart = part;\r\n            part = part.toLowerCase().trim();\r\n\r\n            return prefixes.some(function (prefix) {\r\n                originalPart = originalPart.slice(0, prefix.length);\r\n\r\n                var matched =  part.slice(0, prefix.length) === prefix;\r\n                if(matched){\r\n                    result.matchedBy = originalPart;\r\n                }\r\n                return matched;\r\n            });\r\n        });\r\n        result.matched = matched && !selectedSuggestions[suggestion[options.uidProperty]];\r\n        return result;\r\n    }\r\n\r\n    window.uiDropDownUsersMatcher = uiDropDownUsersMatcher;\r\n})(window);","/**\r\n * Created by andrievskiy on 03.06.17.\r\n */\r\n;(function (window) {\r\n    var defaultUiDropDownOptions = {\r\n        limit: 20\r\n    };\r\n\r\n    function UiDropDown(selector, options) {\r\n        var self = this;\r\n        self.cache = {};\r\n\r\n        options = options || defaultUiDropDownOptions;\r\n\r\n        self.lastVal = null;\r\n        self.inputElement = UiElement(selector);\r\n        self.suggestions = options.suggestions || [];\r\n        self.options = options;\r\n        self.matcher = options.matcher || uiDropDownUsersMatcher;\r\n        // TODO: Добавить подсветку префиксов\r\n        self.options.itemTemplate = '<div class=\"ui-drop-down-multiple-item\" data-user-id=\"{data.id}\"><p>{name}</p></div>';\r\n\r\n        self.matchedSuggestions = [];\r\n        self.selectedItems = Object.create(null);\r\n\r\n        self._dropDownInputWrapper = createDropDownInputWrapper();\r\n        self._suggestionsWrapper = createSuggestionWrapper();\r\n        self._selectedContainer = createSelectedSuggestionsContainer();\r\n\r\n        self.inputElement.wrap(self._dropDownInputWrapper);\r\n        self._dropDownInputWrapper.append(self._suggestionsWrapper.element);\r\n        self._dropDownInputWrapper.element.insertBefore(self._selectedContainer.element, self.inputElement.element);\r\n\r\n        self.inputElement.on('focus', onFocusInputHandler);\r\n        self.inputElement.on('keyup', deBounce(onKeyUpInputHandler, 300));\r\n        self.inputElement.on('blur', onBlurInputElement);\r\n\r\n        self._dropDownInputWrapper.on('click', onWrapperClick);\r\n\r\n        self._suggestionsWrapper.on('mouseenter', onHoverSuggestionsWrapper);\r\n        self._suggestionsWrapper.on('mouseleave', onMouseLeaveSuggestionsWrapper);\r\n\r\n        self.getSelected = function () {\r\n            return Object.keys(self.selectedItems).map(function (key) {\r\n                return self.selectedItems[key];\r\n            });\r\n        };\r\n\r\n        function deBounce(func, wait, immediate) {\r\n            var timeout;\r\n            return function () {\r\n                var context = this, args = arguments;\r\n                var later = function () {\r\n                    timeout = null;\r\n                    if (!immediate) func.apply(context, args);\r\n                };\r\n                var callNow = immediate && !timeout;\r\n                clearTimeout(timeout);\r\n                timeout = setTimeout(later, wait);\r\n                if (callNow) func.apply(context, args);\r\n            };\r\n        }\r\n\r\n\r\n        function onFocusInputHandler() {\r\n            lookup();\r\n            showSuggestionList();\r\n            renderMatchedSuggestions();\r\n        }\r\n\r\n        function onKeyUpInputHandler() {\r\n            lookup();\r\n            renderMatchedSuggestions();\r\n        }\r\n\r\n        function onWrapperClick(event) {\r\n            if (event.target === this) {\r\n                self.inputElement.element.focus();\r\n            }\r\n        }\r\n\r\n        function onBlurInputElement() {\r\n            if (self._suggestionsWrapper.hovered) {\r\n                return;\r\n            }\r\n            hideSuggestionList();\r\n        }\r\n\r\n        function onHoverSuggestionsWrapper() {\r\n            self._suggestionsWrapper.hovered = true;\r\n        }\r\n\r\n        function onMouseLeaveSuggestionsWrapper() {\r\n            self._suggestionsWrapper.hovered = false;\r\n        }\r\n\r\n\r\n        function createSuggestionWrapper() {\r\n            var element = UiElement.create('div');\r\n            element.addClass('ui-drop-down-autocomplete-suggestions');\r\n            return element;\r\n        }\r\n\r\n        function createDropDownInputWrapper() {\r\n            function setWidth(wrapper) {\r\n                wrapper.style.width = self.inputElement.clientWidth() + 'px';\r\n            }\r\n\r\n            var element = UiElement.create('div');\r\n            element.addClass('ui-drop-down-input-wrapper');\r\n            setWidth(element);\r\n\r\n            return element;\r\n        }\r\n\r\n        function createSelectedSuggestionsContainer() {\r\n            var element = UiElement.create('div');\r\n            element.addClass('ui-drop-down-selected-container');\r\n\r\n            return element;\r\n        }\r\n\r\n        function showSuggestionList() {\r\n            self._suggestionsWrapper.addClass('show');\r\n            positionSuggestionList();\r\n        }\r\n\r\n        function hideSuggestionList() {\r\n            self._suggestionsWrapper.removeClass('show');\r\n        }\r\n\r\n        /**\r\n         * Прозводит позиционирование блока предложений относительно эелемента\r\n         */\r\n        function positionSuggestionList() {\r\n            var inputWrapperCoordinates = self._dropDownInputWrapper.getCoordinates();\r\n\r\n            self._suggestionsWrapper.style.top =\r\n                inputWrapperCoordinates.bottom + self.inputElement.clientTop() + 'px';\r\n\r\n            self._suggestionsWrapper.style.left = inputWrapperCoordinates.left + 'px';\r\n\r\n            self._suggestionsWrapper.style.width =\r\n                self.inputElement.offsetWidth() - self._suggestionsWrapper.clientLeft()\r\n                - self._suggestionsWrapper.clientRight() + 'px';\r\n        }\r\n\r\n\r\n        function renderMatchedSuggestions() {\r\n            var children = Array.prototype.slice.apply(self._suggestionsWrapper.element.children);\r\n\r\n            children.forEach(function (childNode) {\r\n                self._suggestionsWrapper.removeChild(childNode);\r\n            });\r\n\r\n            self.matchedSuggestions.forEach(function (item) {\r\n                self._suggestionsWrapper.append(renderSuggestion(item));\r\n            });\r\n        }\r\n\r\n        function renderSuggestion(suggestion) {\r\n            // TODO: Исправить проброс matchedBy\r\n            var matchedBy = suggestion.mathedBy;\r\n            delete suggestion.mathedBy;\r\n\r\n            var dropDownItem = DropDownItem(self.options.itemTemplate, suggestion, matchedBy);\r\n            dropDownItem.render();\r\n\r\n            // TODO: разобрать на отдельные методы. Добавить setter val на uiElement\r\n            // TODO: пернести обработчик на suggestion-list. Испрользовать делегирование,\r\n            // TODO: чтообы избавиться от лишних обработчиков\r\n            // TODO: С ходу мешает необходимость ссылки на item(suggestion)\r\n            dropDownItem.uiElement.on('click', function () {\r\n                onSelectSuggestion(suggestion, this);\r\n            });\r\n\r\n            return dropDownItem.uiElement.element;\r\n        }\r\n\r\n        function lookup() {\r\n            var counter = 0;\r\n            var idx = 0;\r\n            var val = self.inputElement.val();\r\n\r\n            if (val == self.lastVal && val !== '') {\r\n                return;\r\n            }\r\n\r\n            self.lastVal = val;\r\n            self.matchedSuggestions = [];\r\n\r\n            if (val === '') {\r\n                while (counter < self.options.limit && idx < self.suggestions.length) {\r\n                    var item = self.suggestions[idx];\r\n                    if (self.selectedItems[item.uid]) {\r\n                        idx++;\r\n                        continue;\r\n                    }\r\n                    self.matchedSuggestions.push(item);\r\n                    counter++;\r\n                    idx++;\r\n                }\r\n                return;\r\n            }\r\n\r\n            console.time('lookUp');\r\n            idx = 0;\r\n            counter = 0;\r\n            while (counter < self.options.limit && idx < self.suggestions.length) {\r\n                var matchResult = self.matcher(val, self.suggestions[idx], self.selectedItems);\r\n                if(matchResult.matched){\r\n\r\n                    self.suggestions[idx].mathedBy = matchResult.matchedBy;\r\n                    self.matchedSuggestions.push(self.suggestions[idx]);\r\n                    counter++;\r\n                }\r\n                idx++;\r\n            }\r\n            console.timeEnd('lookUp');\r\n        }\r\n\r\n        function onSelectSuggestion(item, element) {\r\n            self.selectedItems[item.uid] = item;\r\n            element.parentNode.removeChild(element);\r\n            self.inputElement.val('');\r\n            hideSuggestionList();\r\n            renderSelectedSuggestion(item);\r\n        }\r\n\r\n        function renderSelectedSuggestion(suggestion) {\r\n            var element = UiElement.create('div');\r\n            element.addClass('ui-drop-down-selected-suggestion');\r\n            element.html(suggestion.name);\r\n            self._selectedContainer.append(element.element);\r\n        }\r\n    }\r\n\r\n    window.UiDropDown = UiDropDown;\r\n})(window);"]}