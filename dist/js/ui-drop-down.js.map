{"version":3,"sources":["_0uiDropDownPoliffils.js","ajax/ajax.js","dom/element.js","html/htmlUtil.js","template/template.js","_uiDropDownSuggestionItem.js","_uiDropDownSelectedSuggestionItem.js","_uiDropDownUsersMatcher.js","uiDropDownWidget.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/PA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ui-drop-down.js","sourcesContent":["/**\r\n * Created by andrievskiy on 05.06.2017.\r\n */\r\nif (!Object.assign) {\r\n    Object.defineProperty(Object, 'assign', {\r\n        enumerable: false,\r\n        configurable: true,\r\n        writable: true,\r\n        value: function (target, firstSource) {\r\n            'use strict';\r\n            if (target === undefined || target === null) {\r\n                throw new TypeError('Cannot convert first argument to object');\r\n            }\r\n\r\n            var to = Object(target);\r\n            for (var i = 1; i < arguments.length; i++) {\r\n                var nextSource = arguments[i];\r\n                if (nextSource === undefined || nextSource === null) {\r\n                    continue;\r\n                }\r\n\r\n                var keysArray = Object.keys(Object(nextSource));\r\n                for (var nextIndex = 0, len = keysArray.length; nextIndex < len; nextIndex++) {\r\n                    var nextKey = keysArray[nextIndex];\r\n                    var desc = Object.getOwnPropertyDescriptor(nextSource, nextKey);\r\n                    if (desc !== undefined && desc.enumerable) {\r\n                        to[nextKey] = nextSource[nextKey];\r\n                    }\r\n                }\r\n            }\r\n            return to;\r\n        }\r\n    });\r\n}","(function (window) {\r\n    function _makeGetArgs(params) {\r\n        var parts = [];\r\n        Object.keys(params).forEach(function (key) {\r\n            parts.push(key + '=' + params[key]);\r\n        });\r\n        return '?' + parts.join('&');\r\n    }\r\n\r\n    function isOkStatusCode(code){\r\n        return code >= 200 && code < 300;\r\n    }\r\n\r\n    function uiDropDownAjax(options) {\r\n        var xhr = new XMLHttpRequest();\r\n        var url = options.url + _makeGetArgs(options.params);\r\n        xhr.open(options.method.toUpperCase(), url);\r\n\r\n        xhr.onerror = function () {\r\n            console.error(xhr.status, xhr.statusText);\r\n            if (options.onError) {\r\n                options.onError(xhr);\r\n            }\r\n        };\r\n\r\n        xhr.onload = function () {\r\n            var response;\r\n            if (isOkStatusCode(xhr.status)) {\r\n                if (options.onSuccess) {\r\n                    if (~xhr.getResponseHeader('Content-Type').indexOf('application/json')) {\r\n                        try {\r\n                            response = JSON.parse(xhr.responseText);\r\n                        } catch (e) {\r\n                            console.error(e);\r\n                        }\r\n                    } else {\r\n                        response = xhr.responseText;\r\n                    }\r\n                    options.onSuccess(response);\r\n                }\r\n            } else{\r\n                console.error('Unexpected response code: ', xhr.status);\r\n            }\r\n        };\r\n\r\n        if (options.method.toUpperCase() != 'GET') {\r\n            xhr.send(options.data);\r\n        } else {\r\n            xhr.send();\r\n        }\r\n        return xhr;\r\n    }\r\n\r\n    window.uiDropDownajax = uiDropDownAjax;\r\n})(window);","/**\r\n * Модуль для работы с DOM\r\n */\r\n(function (window) {\r\n    'use strict';\r\n\r\n    /**\r\n     * @param selectorOrElement {String | HtmlElement}\r\n     * @returns {_UiElement}\r\n     * @constructor\r\n     */\r\n    function UiElement(selectorOrElement) {\r\n        return new _UiElement(selectorOrElement);\r\n    }\r\n\r\n    /**\r\n     * Create new DOM element and wrap to UiElement\r\n     * @param tagName\r\n     * @returns {_UiElement}\r\n     */\r\n    UiElement.create = function (tagName) {\r\n        return new _UiElement(document.createElement(tagName));\r\n    };\r\n\r\n\r\n    /**\r\n     * Класс враппера для работы с DOM елементами\r\n     * @param selectorOrElement\r\n     * @private\r\n     */\r\n    function _UiElement(selectorOrElement) {\r\n        this.element = null;\r\n        if (typeof selectorOrElement == \"string\") {\r\n            this.element = document.querySelector(selectorOrElement);\r\n        }\r\n        if (selectorOrElement instanceof HTMLElement) {\r\n            this.element = selectorOrElement;\r\n        }\r\n        if(this.element === null){\r\n            console.error('Invalid or unsupported selector or dom element: ' + selectorOrElement);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Расчет координат относительно документа, учитывая clientTop/clientLeft\r\n     * @returns {{top: number, left: number}}\r\n     */\r\n    _UiElement.prototype.getCoordinates = function () {\r\n        var byWindow = this.element.getBoundingClientRect();\r\n        var bodyElement = document.body;\r\n        var documentElement = document.documentElement;\r\n\r\n        var scrollTop = window.pageYOffset || documentElement.scrollTop || bodyElement.scrollTop;\r\n        var scrollLeft = window.pageXOffset || documentElement.scrollLeft || bodyElement.scrollLeft;\r\n\r\n        var clientTop = documentElement.clientTop || bodyElement.clientTop || 0;\r\n        var clientLeft = documentElement.clientLeft || bodyElement.clientLeft || 0;\r\n\r\n        return {\r\n            top: byWindow.top + scrollTop - clientTop,\r\n            left: byWindow.left + scrollLeft - clientLeft,\r\n            bottom: byWindow.bottom + scrollTop - clientTop,\r\n            right: byWindow.right + scrollLeft - clientLeft\r\n        }\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {number}\r\n     */\r\n    _UiElement.prototype.clientLeft = function () {\r\n        return this.element.clientLeft;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {number}\r\n     */\r\n    _UiElement.prototype.clientRight = function () {\r\n        var computedStyles = window.getComputedStyle(this.element);\r\n        var borderRight = computedStyles.borderRightWidth;\r\n        borderRight = borderRight.split('px')[0];\r\n        return +borderRight;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {number}\r\n     */\r\n    _UiElement.prototype.clientTop = function () {\r\n        return this.element.clientTop;\r\n    };\r\n\r\n\r\n    /**\r\n     *\r\n     * @returns {number}\r\n     */\r\n    _UiElement.prototype.offsetWidth = function () {\r\n        return this.element.offsetWidth;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @returns {number}\r\n     */\r\n    _UiElement.prototype.clientWidth = function () {\r\n        return this.element.clientWidth;\r\n    };\r\n\r\n    _UiElement.prototype.offsetHeight = function () {\r\n        return this.element.offsetHeight;\r\n    };\r\n\r\n    _UiElement.prototype.clientHeight = function () {\r\n        return this.element.clientHeight;\r\n    };\r\n\r\n\r\n\r\n    /**\r\n     *\r\n     * @returns {number}\r\n     */\r\n    _UiElement.prototype.scrollWidth = function () {\r\n        return this.element.scrollWidth;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param cls\r\n     */\r\n    _UiElement.prototype.addClass = function (cls) {\r\n        this.element.classList.add(cls);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param cls\r\n     */\r\n    _UiElement.prototype.removeClass = function (cls) {\r\n      this.element.classList.remove(cls);\r\n    };\r\n\r\n    /**\r\n     * Обернуть элемент враппером\r\n     * @param wrapper {UiElement}\r\n     */\r\n    _UiElement.prototype.wrap = function (wrapper) {\r\n        var el, parent;\r\n        if(wrapper instanceof _UiElement){\r\n            el = wrapper.element;\r\n        } else{\r\n            el = wrapper;\r\n        }\r\n\r\n        parent = this.element.parentNode;\r\n\r\n\r\n        if(this.element.nextSibling){\r\n            parent.insertBefore(el, this.element.nextSibling);\r\n        } else {\r\n            parent.appendChild(el);\r\n        }\r\n        el.appendChild(this.element);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param value\r\n     * @returns {*|string|Number|undefined}\r\n     */\r\n    _UiElement.prototype.val = function (value) {\r\n        if(value != undefined){\r\n            this.element.value = value;\r\n            return;\r\n        }\r\n        return this.element.value;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param eventKey\r\n     * @param callback\r\n     * @param stage\r\n     */\r\n    _UiElement.prototype.on = function (eventKey, callback, stage) {\r\n        this.element.addEventListener(eventKey, callback, stage);\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param evenKey\r\n     * @param callback\r\n     * @param stage\r\n     */\r\n    _UiElement.prototype.off = function (evenKey, callback, stage) {\r\n        this.element.removeEventListener(evenKey, callback, stage);\r\n    };\r\n    /**\r\n     * Удалить потомка\r\n     * @param child\r\n     * @returns {Node}\r\n     */\r\n    _UiElement.prototype.removeChild =function (child) {\r\n        return this.element.removeChild(child);\r\n    };\r\n\r\n    /**\r\n     * Добаить потомка к элементу\r\n     * @param child\r\n     * @returns {Node}\r\n     */\r\n    _UiElement.prototype.append = function (child) {\r\n        if(child instanceof _UiElement){\r\n             return this.element.appendChild(child.element);\r\n        }\r\n        return this.element.appendChild(child);\r\n    };\r\n\r\n    _UiElement.prototype.html = function (val) {\r\n        if(val != undefined){\r\n            this.element.innerHTML = val;\r\n            return;\r\n        }\r\n        return this.element.innerHTML;\r\n    };\r\n\r\n    _UiElement.prototype.remove = function(){\r\n        this.element.parentNode.removeChild(this.element);\r\n    };\r\n\r\n    _UiElement.prototype.css = function (css) {\r\n        var self = this;\r\n        if(!css){\r\n            return window.getComputedStyle(this.element);\r\n        }\r\n        Object.keys(css).forEach(function (property) {\r\n           self.element.style[property] = css[property];\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Прокси для проброса style\r\n     */\r\n    Object.defineProperties(_UiElement.prototype, {\r\n        style: {\r\n            get: function () {\r\n                return this.element.style;\r\n            }\r\n        }\r\n    });\r\n\r\n    window.UiElement = UiElement;\r\n\r\n})(window);","(function (window) {\r\n    var ESCAPE_CHARS = {\r\n        '¢': 'cent',\r\n        '£': 'pound',\r\n        '¥': 'yen',\r\n        '€': 'euro',\r\n        '©': 'copy',\r\n        '®': 'reg',\r\n        '<': 'lt',\r\n        '>': 'gt',\r\n        '\"': 'quot',\r\n        '&': 'amp',\r\n        '\\'': '#39'\r\n    }, regex;\r\n\r\n    function _makeRegexpString() {\r\n        var regexString = '[';\r\n\r\n        for (var key in ESCAPE_CHARS) {\r\n            regexString += key;\r\n        }\r\n        regexString += ']';\r\n\r\n        return regexString;\r\n    }\r\n\r\n    regex = new RegExp(_makeRegexpString(), 'g');\r\n\r\n    function uiDropDownHtmlEscaping(str) {\r\n        if(typeof str != 'string'){\r\n            return str;\r\n        }\r\n        return str.replace(regex, function (m) {\r\n            return '&' + ESCAPE_CHARS[m] + ';';\r\n        });\r\n    }\r\n\r\n    window.uiDropDownHtmlEscaping = uiDropDownHtmlEscaping;\r\n})(window);",";(function (window) {\r\n    function renderTemplate(template, data) {\r\n        return template.replace(/{([\\w|:]+)}/g, function (match, key) {\r\n\r\n            var isHtml = ~key.indexOf('::html');\r\n            if(isHtml){\r\n                key = key.split('::')[0];\r\n                return data[key] || '';\r\n            }\r\n            return uiDropDownHtmlEscaping(data[key] || '');\r\n        })\r\n    }\r\n    window.uiRenderTemplate = renderTemplate;\r\n})(window);",";(function (window) {\r\n    function DropDownSuggestionItem(template, data, matchedBy) {\r\n        return new _DropDownSuggestionItem(template, data, matchedBy);\r\n    }\r\n\r\n    function _DropDownSuggestionItem(template, data, matchedBy, defaultAvatarUrl) {\r\n        var self = this;\r\n        this.uiElement = UiElement.create('div');\r\n        this.uiElement.addClass('ui-drop-down-item-container');\r\n\r\n        this.template = template;\r\n        this.data = data;\r\n        this.matchedBy = matchedBy;\r\n\r\n        this.name = uiDropDownHtmlEscaping(this.data.name);\r\n        this.name = this.name.replace(this.matchedBy, '<span class=\"ui-drop-down-highlight\">' + this.matchedBy + '</span>');\r\n        this.uid = this.data.uid;\r\n        this.avatarUrl = this.data.avatarUrl || this.data.avatar || defaultAvatarUrl || '';\r\n\r\n\r\n        Object.keys(this.data).forEach(function (dataKey) {\r\n            if(!self[dataKey]){\r\n                self[dataKey] = self.data[dataKey];\r\n            }\r\n        });\r\n    }\r\n    \r\n    _DropDownSuggestionItem.prototype.render = function () {\r\n        var html = uiRenderTemplate(this.template, this);\r\n        this.uiElement.html(html);\r\n        return this.uiElement;\r\n    };\r\n\r\n    window.DropDownSuggestionItem = DropDownSuggestionItem;\r\n})(window);",";(function (window) {\r\n    var dropDownItemDefaultTemplate = '';\r\n\r\n    function DropDownSelectedSuggestionItem(template, data, matchedBy) {\r\n        return new _DropDownSelectedSuggestionItem(template, data, matchedBy);\r\n    }\r\n\r\n    function _DropDownSelectedSuggestionItem(template, data, multiple) {\r\n        var self = this;\r\n        this.uiElement = UiElement.create('div');\r\n        var containerCls = multiple ? 'ui-drop-down-selected-suggestion': 'ui-drop-down-single-selected-suggestion';\r\n        this.uiElement.addClass(containerCls);\r\n\r\n        this.template = template || dropDownItemDefaultTemplate;\r\n        this.data = data;\r\n        this.name = this.data.name;\r\n        this.uid = this.data.uid;\r\n\r\n        Object.keys(this.data).forEach(function (dataKey) {\r\n            if(!self[dataKey]){\r\n                self[dataKey] = self.data[dataKey];\r\n            }\r\n        });\r\n    }\r\n    \r\n    _DropDownSelectedSuggestionItem.prototype.render = function () {\r\n        var html = uiRenderTemplate(this.template, this);\r\n        this.uiElement.html(html);\r\n        return this.uiElement;\r\n    };\r\n\r\n    window.DropDownSelectedSuggestionItem = DropDownSelectedSuggestionItem;\r\n})(window);","(function (window) {\r\n    'use strict';\r\n    var LATIN_TO_CYRILLIC_KEYBOARD = {\r\n        'q': 'й',\r\n        'w': 'ц',\r\n        'e': 'у',\r\n        'r': 'к',\r\n        't': 'е',\r\n        'y': 'н',\r\n        'u': 'г',\r\n        'i': 'ш',\r\n        'o': 'щ',\r\n        'p': 'з',\r\n        '{': 'х',\r\n        '}': 'ъ',\r\n        'a': 'ф',\r\n        's': 'ы',\r\n        'd': 'в',\r\n        'f': 'а',\r\n        'g': 'п',\r\n        'h': 'р',\r\n        'j': 'о',\r\n        'k': 'л',\r\n        'l': 'д',\r\n        ';': 'ж',\r\n        \"'\": 'э',\r\n        'z': 'я',\r\n        'x': 'ч',\r\n        'c': 'с',\r\n        'v': 'м',\r\n        'b': 'и',\r\n        'n': 'т',\r\n        'm': 'ь',\r\n        ',': 'б',\r\n        '.': 'ю'\r\n    };\r\n    var CYRILLIC_TO_LATIN_KEYBOARD = {};\r\n\r\n    Object.keys(LATIN_TO_CYRILLIC_KEYBOARD).map(function (key) {\r\n        var k = LATIN_TO_CYRILLIC_KEYBOARD[key];\r\n        CYRILLIC_TO_LATIN_KEYBOARD[k] = key;\r\n    });\r\n\r\n\r\n    var LATIN_TO_CYRILLIC_FIRST_REPLACE_MAP = {\r\n        'shch': 'щ',\r\n        'sch': 'щ',\r\n        'yo': 'ё',\r\n        'zh': 'ж',\r\n        'kh': 'х',\r\n        'ts': 'ц',\r\n        'ch': 'ч',\r\n        'sh': 'ш',\r\n        'eh': 'э',\r\n        'yu': 'ю',\r\n        'ya': 'я',\r\n        \"'\": 'ь'\r\n    };\r\n\r\n    var CYRILLIC_TO_LATIN_FIRST_REPLACE_MAP = {};\r\n\r\n    Object.keys(LATIN_TO_CYRILLIC_FIRST_REPLACE_MAP).map(function (key) {\r\n        var k = LATIN_TO_CYRILLIC_FIRST_REPLACE_MAP[key];\r\n        CYRILLIC_TO_LATIN_FIRST_REPLACE_MAP[k] = key;\r\n    });\r\n\r\n    var MULTIPLE_LATIN_CHARTS = {\r\n        'y': ['ы', 'ё', 'ю', 'я'],\r\n        'z': ['ж', 'з'],\r\n        'k': ['х', 'к'],\r\n        't': ['ц', 'т'],\r\n        'c': ['ц', 'ч',  'щ'],\r\n        's': ['ш', 'щ', 'с'],\r\n        'e': ['е', 'э']\r\n    };\r\n\r\n    var LATIN_ALPHABET = 'abvgdezijklmnoprstufhcyABVGDEZIJKLMNOPRSTUFHCYёЁ';\r\n    var CYRILLIC_ALPHABET = 'абвгдезийклмнопрстуфхцыАБВГДЕЗИЙКЛМНОПРСТУФХЦЫеЕ';\r\n\r\n\r\n    function _toCyrillicKeyboard(str) {\r\n        var result = '';\r\n        var charts = str.split('');\r\n        charts.forEach(function (chart) {\r\n            result += LATIN_TO_CYRILLIC_KEYBOARD[chart] || chart;\r\n        });\r\n\r\n        return result;\r\n    }\r\n\r\n    function _toLatinKeyboard(str) {\r\n        var result = '';\r\n        var charts = str.split('');\r\n        charts.forEach(function (chart) {\r\n            result += CYRILLIC_TO_LATIN_KEYBOARD[chart] || chart;\r\n        });\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Получение всех возможных уникальных вариантов для поиска\r\n     *\r\n     * @param prefix\r\n     * @returns {Array}\r\n     * @private\r\n     */\r\n    function _getPrefixVariables(prefix) {\r\n        var variables = [];\r\n        var cyrillicKeyboard;\r\n        var latinKeyboard;\r\n\r\n        // Получение всех кирилических вариантов по латинице\r\n        // За счет того, что латиница уже, то одну строку на ней\r\n        // Можжно представить несколькими на кирилице\r\n        // Например: z = ж/z = з\r\n        variables = variables.concat(_latinToCyrillicVariants(prefix));\r\n\r\n        // Приведение кириллицы к латинице\r\n        // Например: юа => yoa\r\n        variables.concat(_cyrillicToLatinVariants(prefix));\r\n\r\n        // Приведение расладок\r\n\r\n        cyrillicKeyboard = _toCyrillicKeyboard(prefix);\r\n        latinKeyboard = _toLatinKeyboard(prefix);\r\n        variables.push(cyrillicKeyboard);\r\n        variables.push(latinKeyboard);\r\n\r\n        // Транслитерация для раскладок\r\n        // Например: кщпщя -> rogoz -> рогоз\r\n        variables.push(_cyrillicToLatinVariants(cyrillicKeyboard));\r\n        variables = variables.concat(_latinToCyrillicVariants(latinKeyboard));\r\n\r\n        // Вывод уникальных валидаторов\r\n        // TODO: Оптимизироввать через set\r\n        variables = variables.filter(function (item, idx, array) {\r\n            return array.indexOf(item) === idx;\r\n        });\r\n\r\n        return variables;\r\n    }\r\n\r\n\r\n    function _latinToCyrillicVariants(str) {\r\n        var variants;\r\n        var charts;\r\n\r\n        // Сначала происходит замена \"букв\" из нескольких символов\r\n        // TODO: Добавить сортировку ключей\r\n        Object.keys(LATIN_TO_CYRILLIC_FIRST_REPLACE_MAP).forEach(function (char) {\r\n           str = str.split(char).join(LATIN_TO_CYRILLIC_FIRST_REPLACE_MAP[char]);\r\n        });\r\n\r\n        charts = str.split('');\r\n\r\n        variants = _extendVariants(charts);\r\n        variants = variants.map(function (variant) {\r\n            return _replace(variant.join(''));\r\n        });\r\n\r\n        return variants;\r\n\r\n        /**\r\n         * Производит расширение вариантов для  символов соответствующих нескольким русским буквам\r\n         * при условии что символ находится в конце строки (т.е. невозиожно определить к чему он приводится)\r\n         * @param charts\r\n         * @returns {*[]}\r\n         * @private\r\n         */\r\n        function _extendVariants(charts) {\r\n            var variants = [charts];\r\n            var lastChart = charts[charts.length - 1];\r\n            var chartVariants;\r\n\r\n            if(MULTIPLE_LATIN_CHARTS[lastChart]){\r\n                variants = [];\r\n                chartVariants = MULTIPLE_LATIN_CHARTS[lastChart];\r\n                chartVariants.forEach(function (chartVar) {\r\n\r\n                    var newVariant = charts.slice(0, charts.length - 1);\r\n                    newVariant.push(chartVar);\r\n                    variants.push(newVariant);\r\n                });\r\n            }\r\n            return variants;\r\n        }\r\n\r\n        function _replace(str) {\r\n            for (var i = 0; i < LATIN_ALPHABET.length; i++) {\r\n                str = str.split(LATIN_ALPHABET.charAt(i)).join(CYRILLIC_ALPHABET.charAt(i));\r\n            }\r\n            return str;\r\n        }\r\n    }\r\n\r\n\r\n    function _cyrillicToLatinVariants(str) {\r\n        // TODO: Добавить сортировку ключей\r\n        // Сначала происходит замена \"букв\" из нескольких символов\r\n        Object.keys(CYRILLIC_TO_LATIN_FIRST_REPLACE_MAP).forEach(function (char) {\r\n           str = str.split(char).join(CYRILLIC_TO_LATIN_FIRST_REPLACE_MAP[char]);\r\n        });\r\n\r\n        function _replace(str) {\r\n            for (var i = 0; i < CYRILLIC_ALPHABET.length; i++) {\r\n                str = str.split(CYRILLIC_ALPHABET.charAt(i)).join(LATIN_ALPHABET.charAt(i));\r\n            }\r\n            return str;\r\n        }\r\n        return [_replace(str)];\r\n    }\r\n\r\n\r\n    /**\r\n     * Производит сравнение по префиксу с учетом раскладок и транслитерации\r\n     * @param prefix {String}\r\n     * @param suggestion {Object}\r\n     * @param selectedSuggestions {Array}\r\n     * @param options {Object}\r\n     * @param options.byProperty {String} - свойтво по которму производится сравненение\r\n     * @param options.uidProperty {String} - свойтво уникальный идентификатор\r\n     * @returns {Object}\r\n     */\r\n    function uiDropDownUsersMatcher(prefix, suggestion, selectedSuggestions, options) {\r\n        // TODO: произветси оптимизацию поиска\r\n        options = options || { byProperty: 'name', uidProperty: 'uid' };\r\n\r\n        var result = {\r\n            matched: false,\r\n            matchedBy: null\r\n        };\r\n        var prefixes, suggestionParts, matched;\r\n\r\n        if(selectedSuggestions[suggestion[options.uidProperty]]){\r\n            return result;\r\n        }\r\n\r\n        prefix = prefix.trim().toLowerCase();\r\n\r\n        prefixes = _getPrefixVariables(prefix);\r\n\r\n        suggestionParts = suggestion[options.byProperty].split(' ');\r\n\r\n        suggestionParts.push(suggestion[options.byProperty]);\r\n\r\n        matched = suggestionParts.some(function (part) {\r\n            var originalPart = part;\r\n            part = part.toLowerCase().trim();\r\n\r\n            return prefixes.some(function (prefix) {\r\n                originalPart = originalPart.slice(0, prefix.length);\r\n\r\n                var matched =  part.slice(0, prefix.length) === prefix;\r\n                if(matched){\r\n                    result.matchedBy = originalPart;\r\n                }\r\n                return matched;\r\n            });\r\n        });\r\n        result.matched = matched && !selectedSuggestions[suggestion[options.uidProperty]];\r\n        return result;\r\n    }\r\n\r\n    window.uiDropDownUsersMatcher = uiDropDownUsersMatcher;\r\n})(window);",";(function (window) {\r\n    var DEFAULT_SUGGESTION_TEMPLATE =\r\n        '<div class=\"ui-drop-down-suggestion-item\" data-user-id=\"{uid}\">' +\r\n        '   <img class=\"ui-drop-down-suggestion-item-avatar\" src=\"{avatarUrl}\">' +\r\n        '   <label class=\"ui-drop-down-suggestion-item-name\">{name::html}</label>' +\r\n        '   <span class=\"ui-drop-down-suggestion-item-extra\">{extra}</span>' +\r\n        '</div>';\r\n\r\n    var DEFAULT_SUGGESTION_TEMPLATE_WITHOUT_AVATARS =\r\n        '<div class=\"ui-drop-down-suggestion-item\" data-user-id=\"{uid}\">' +\r\n        '   <label class=\"ui-drop-down-suggestion-item-name\">{name::html}</label>' +\r\n        '</div>';\r\n\r\n    var DEFAULT_MULTIPLE_SELECTED_ITEM_TEMPLATE =\r\n        '<div class=\"ui-drop-down-selected-item\">' +\r\n        '   <div class=\"ui-drop-down-selected-name\">{name}</div>' +\r\n        '   <a class=\"ui-drop-down-selected-remove-btn\" data-user-id=\"{uid}\" data-is-remove-button=\"true\"></a>' +\r\n        '</div>';\r\n\r\n    var DEFAULT_SINGLE_SELECTED_ITEM_TEMPLATE =\r\n        '<div class=\"ui-drop-down-single-selected-item\">' +\r\n        '    <div class=\"ui-drop-down-single-selected-name\">{name}</div>' +\r\n        '    <a class=\"ui-drop-down-selected-single-remove-btn\" data-user-id=\"{uid}\" data-is-remove-button=\"true\"></a>' +\r\n        '</div>';\r\n\r\n    var DEFAULT_EMPTY_MESSAGE =\r\n        '<div class=\"ui-drop-down-suggestion-item\">' +\r\n        '   <p>Пользователь не найден</p>' +\r\n        '</div>';\r\n\r\n    var DEFAULT_OPTIONS = {\r\n        multiple: true,\r\n        autocomplete: true,\r\n        showAvatars: true,\r\n        defaultAvatarUrl: null,\r\n        limit: 10,\r\n\r\n        serverSide: false,\r\n        serverSideUrl: '/',\r\n        serverSideMethod: 'GET',\r\n        serverSideFindProperty: 'domain',\r\n        suggestionIdentifierProperty: 'uid',\r\n\r\n        suggestionTemplateWithAvatar: DEFAULT_SUGGESTION_TEMPLATE,\r\n        suggestionTemplateWithoutAvatar: DEFAULT_SUGGESTION_TEMPLATE_WITHOUT_AVATARS,\r\n        selectedMultipleItemTemplate: DEFAULT_MULTIPLE_SELECTED_ITEM_TEMPLATE,\r\n        selectedSingleItemTemplate: DEFAULT_SINGLE_SELECTED_ITEM_TEMPLATE,\r\n        emptyMessageTemplate: DEFAULT_EMPTY_MESSAGE\r\n\r\n    };\r\n\r\n    function UiDropDown(selector, options) {\r\n        var self = this;\r\n\r\n        options = options || {};\r\n\r\n        /**\r\n         * Возравщает список выбранных элементов\r\n         * @returns {Array}\r\n         */\r\n        self.getSelected = function () {\r\n            return Object.keys(self.selectedItems).map(function (key) {\r\n                return self.selectedItems[key];\r\n            });\r\n        };\r\n\r\n        self.options = Object.assign({}, DEFAULT_OPTIONS, options);\r\n\r\n        self._cache = {};\r\n        self._lastVal = null;\r\n        self._serverQuryIsRunning = false;\r\n\r\n        self._suggestionTemplate = getSuggestionTemplate();\r\n        self._selectedItemTemplate = getSelectedItemTemplate();\r\n\r\n        self.inputElement = UiElement(selector);\r\n        self.inputElement.addClass('ui-drop-down-input');\r\n        if (!self.options.autocomplete) {\r\n            self.inputElement.element.setAttribute('readonly', 'true');\r\n        }\r\n\r\n        self.suggestions = self.options.suggestions || [];\r\n        self.matcher = self.options.matcher || uiDropDownUsersMatcher;\r\n\r\n        self.matchedSuggestions = [];\r\n        self._matchesSuggestionIds = Object.create(null);\r\n        self.selectedItems = Object.create(null);\r\n\r\n        self._dropDownInputWrapper = createDropDownInputWrapper();\r\n        self._suggestionsWrapper = createSuggestionWrapper();\r\n        self._selectedContainer = createSelectedSuggestionsContainer();\r\n        self._dropDownIcon = createDropDownIcon();\r\n        appendElementsToDom();\r\n\r\n\r\n        self.inputElement.on('focus', onFocusInputHandler);\r\n        self.inputElement.on('keyup', deBounce(onKeyUpInputHandler, 300));\r\n        self.inputElement.on('blur', onBlurInputElement);\r\n\r\n        self._dropDownInputWrapper.on('click', onClickWrapper);\r\n\r\n        self._suggestionsWrapper.on('mouseenter', onHoverSuggestionsWrapper);\r\n        self._suggestionsWrapper.on('mouseleave', onMouseLeaveSuggestionsWrapper);\r\n\r\n        self._selectedContainer.on('click', onClickSelectedContainer);\r\n\r\n        function appendElementsToDom() {\r\n            self.inputElement.wrap(self._dropDownInputWrapper);\r\n            document.body.appendChild(self._suggestionsWrapper.element);\r\n\r\n            self._dropDownInputWrapper.element.insertBefore(self._dropDownIcon.element, self.inputElement.element);\r\n            self._dropDownInputWrapper.element.insertBefore(self._selectedContainer.element, self.inputElement.element);\r\n\r\n            var originInputElementW = self.inputElement.clientWidth();\r\n            console.log(originInputElementW);\r\n            console.log('offsetWidth', self._dropDownIcon.offsetWidth());\r\n\r\n            self.inputElement.css({\r\n                width: originInputElementW - self._dropDownIcon.offsetWidth()- 15 + 'px'\r\n            });\r\n        }\r\n\r\n        function createDropDownIcon(){\r\n            var e = UiElement.create('div');\r\n            e.addClass('ui-widget-drop-down-icon');\r\n            return e;\r\n        }\r\n\r\n\r\n        function getSuggestionTemplate() {\r\n            if (self.options.showAvatars) {\r\n                return self.options.suggestionTemplateWithAvatar;\r\n            }\r\n            return self.options.suggestionTemplateWithoutAvatar;\r\n        }\r\n\r\n        function getSelectedItemTemplate() {\r\n            if (self.options.multiple) {\r\n                return self.options.selectedMultipleItemTemplate;\r\n            }\r\n            return self.options.selectedSingleItemTemplate;\r\n        }\r\n\r\n        function isSelected(item) {\r\n            return Boolean(self.selectedItems[item[self.options.suggestionIdentifierProperty]]);\r\n        }\r\n\r\n        function addItemToSelected(item) {\r\n            self.selectedItems[item[self.options.suggestionIdentifierProperty]] = item;\r\n        }\r\n\r\n        function isInMatchedSuggestions(item) {\r\n            return Boolean(self._matchesSuggestionIds[item[self.options.suggestionIdentifierProperty]]);\r\n        }\r\n\r\n        function addToMatchedSuggestions(item) {\r\n            self.matchedSuggestions.push(item);\r\n            self._matchesSuggestionIds[item[self.options.suggestionIdentifierProperty]] = true;\r\n        }\r\n\r\n        function onClickSelectedContainer(event) {\r\n            var target = event.target;\r\n            if (target.getAttribute('data-is-remove-button') == 'true') {\r\n                removeSelectedSuggestion(target);\r\n                if (!self.getSelected().length) {\r\n                    hideSelectedContainer();\r\n                    showInputElement();\r\n                }\r\n            } else {\r\n                activateInputElement();\r\n            }\r\n\r\n        }\r\n\r\n        function open() {\r\n            if ((!self.options.multiple && self.options.autocomplete) || !self.getSelected().length) {\r\n                hideSelectedContainer();\r\n            }\r\n\r\n            showSuggestionList();\r\n            search();\r\n        }\r\n\r\n        function search() {\r\n            lookup();\r\n            renderAllMatchedSuggestions();\r\n        }\r\n\r\n        function close() {\r\n            if (self._suggestionsWrapper.hovered) {\r\n                return;\r\n            }\r\n            hideSuggestiosnList();\r\n            if (self.options.multiple && self.getSelected().length) {\r\n                hideInputElement();\r\n            }\r\n            if (!self.options.multiple && self.getSelected().length) {\r\n                hideInputElement();\r\n                showSelectedContainer();\r\n            }\r\n        }\r\n\r\n        function onFocusInputHandler() {\r\n            open();\r\n        }\r\n\r\n        function onKeyUpInputHandler() {\r\n            search();\r\n        }\r\n\r\n        function onClickWrapper(event) {\r\n            if (event.target === this) {\r\n                activateInputElement();\r\n            }\r\n            if(event.target == self._dropDownIcon.element){\r\n                activateInputElement();\r\n            }\r\n        }\r\n\r\n        function onBlurInputElement() {\r\n            close();\r\n        }\r\n\r\n        function onHoverSuggestionsWrapper() {\r\n            self._suggestionsWrapper.hovered = true;\r\n        }\r\n\r\n        function onMouseLeaveSuggestionsWrapper() {\r\n            self._suggestionsWrapper.hovered = false;\r\n        }\r\n\r\n        function _clearLastSelected() {\r\n            Object.keys(self.selectedItems).forEach(function (prop) {\r\n                delete self.selectedItems[prop];\r\n            });\r\n            var children = Array.prototype.slice.apply(self._selectedContainer.element.children);\r\n            children.forEach(function (child) {\r\n                child.parentNode.removeChild(child);\r\n            });\r\n\r\n        }\r\n\r\n        function onSelectSuggestion(item, element) {\r\n            if (!self.options.multiple) {\r\n                _clearLastSelected();\r\n            }\r\n            addItemToSelected(item);\r\n            element.parentNode.removeChild(element);\r\n            self.inputElement.val('');\r\n            hideSuggestiosnList();\r\n            renderSelectedSuggestion(item);\r\n            hideInputElement();\r\n            // Событие не будет послано брузером. Поэтому нужно простваить руками.\r\n            self._suggestionsWrapper.hovered = false;\r\n            showSelectedContainer();\r\n        }\r\n\r\n        function showSelectedContainer() {\r\n            self._selectedContainer.addClass('show');\r\n        }\r\n\r\n        function hideSelectedContainer() {\r\n            self._selectedContainer.removeClass('show');\r\n        }\r\n\r\n        function hideInputElement() {\r\n            if (self.getSelected().length) {\r\n                self.inputElement.style.display = 'none';\r\n            }\r\n        }\r\n\r\n        function showInputElement() {\r\n            self.inputElement.style.display = 'block';\r\n            if (!self.options.autocomplete && self.getSelected().length) {\r\n                self.inputElement.addClass('ui-drop-down-input-hidden');\r\n            } else {\r\n                self.inputElement.removeClass('ui-drop-down-input-hidden');\r\n            }\r\n        }\r\n\r\n        function focusInputElement() {\r\n            if (document.activeElement !== self.inputElement.element) {\r\n                self.inputElement.element.focus();\r\n            }\r\n        }\r\n\r\n        function activateInputElement() {\r\n            showInputElement();\r\n            focusInputElement();\r\n        }\r\n\r\n        function createSuggestionWrapper() {\r\n            var element = UiElement.create('div');\r\n            element.addClass('ui-drop-down-autocomplete-suggestions');\r\n            return element;\r\n        }\r\n\r\n        function createDropDownInputWrapper() {\r\n            function setStyles(wrapper) {\r\n                var position = self.inputElement.css().position;\r\n                wrapper.css({\r\n                    width: self.inputElement.offsetWidth() + 'px',\r\n                    position: position\r\n                });\r\n            }\r\n\r\n            var element = UiElement.create('div');\r\n            element.addClass('ui-drop-down-input-wrapper');\r\n            setStyles(element);\r\n\r\n            return element;\r\n        }\r\n\r\n        function createSelectedSuggestionsContainer() {\r\n            var element = UiElement.create('div');\r\n            element.addClass('ui-drop-down-selected-container');\r\n\r\n            return element;\r\n        }\r\n\r\n        function showSuggestionList() {\r\n            self._suggestionsWrapper.addClass('show');\r\n            positionSuggestionList();\r\n        }\r\n\r\n        function hideSuggestiosnList() {\r\n            self._suggestionsWrapper.removeClass('show');\r\n        }\r\n\r\n\r\n        /**\r\n         * Прозводит позиционирование блока предложений относительно эелемента\r\n         * В зависимости от его позиционирования(static/relative)\r\n         */\r\n        function positionSuggestionList() {\r\n            var inputWrapperCoordinates = self._dropDownInputWrapper.getCoordinates();\r\n\r\n            self._suggestionsWrapper.style.top =\r\n                inputWrapperCoordinates.bottom - self._dropDownInputWrapper.clientTop() + 'px';\r\n\r\n            self._suggestionsWrapper.style.left = inputWrapperCoordinates.left + 'px';\r\n\r\n            self._suggestionsWrapper.style.width =\r\n                self._dropDownInputWrapper.offsetWidth() - self._suggestionsWrapper.clientLeft() - self._suggestionsWrapper.clientRight() + 'px';\r\n        }\r\n\r\n        function clearMatchedSuggestionsList() {\r\n            var children = Array.prototype.slice.apply(self._suggestionsWrapper.element.children);\r\n\r\n            children.forEach(function (childNode) {\r\n                self._suggestionsWrapper.removeChild(childNode);\r\n            });\r\n        }\r\n\r\n        function renderAllMatchedSuggestions() {\r\n            // Если пачка предложений пуста, то производить очистку и показвать сообщение нужно только\r\n            // Если предложения не смогут появиться с сервера\r\n            if (!self.matchedSuggestions.length && !self._serverQuryIsRunning) {\r\n                clearMatchedSuggestionsList();\r\n                showEmptySuggestionMessage();\r\n                return;\r\n            }\r\n\r\n            // Если запрос еще выпоняется, то очистку списка нужно производить\r\n            // Только если есть записи\r\n            if (self.matchedSuggestions.length) {\r\n                clearMatchedSuggestionsList();\r\n            }\r\n            self.matchedSuggestions.forEach(function (item) {\r\n                renderMatchedSuggestion(item);\r\n            });\r\n        }\r\n\r\n        function renderMatchedSuggestion(suggestion) {\r\n            // TODO: Исправить проброс matchedBy\r\n            var matchedBy = suggestion.mathedBy;\r\n            delete suggestion.mathedBy;\r\n\r\n            var dropDownItem = DropDownSuggestionItem(\r\n                self._suggestionTemplate, suggestion, matchedBy, self.options.defaultAvatarUrl\r\n            );\r\n            dropDownItem.render();\r\n            // TODO: пернести обработчик на suggestion-list. Испрользовать делегирование,\r\n            // TODO: чтообы избавиться от лишних обработчиков\r\n            // TODO: С ходу мешает необходимость ссылки на item(suggestion)\r\n            dropDownItem.uiElement.on('click', function () {\r\n                onSelectSuggestion(suggestion, this);\r\n            });\r\n            self._suggestionsWrapper.append(dropDownItem.uiElement);\r\n        }\r\n\r\n\r\n        function removeSelectedSuggestion(element) {\r\n            // TODO: Добавить id. Чтобы не зависеть от верстки\r\n            var uid = element.getAttribute('data-user-id');\r\n            var container = element.parentNode;\r\n            container = container.parentNode;\r\n            console.log(container);\r\n            delete self.selectedItems[uid];\r\n            container.parentNode.removeChild(container);\r\n\r\n\r\n        }\r\n\r\n        function renderSelectedSuggestion(suggestion) {\r\n            var selectedItem = DropDownSelectedSuggestionItem(\r\n                self._selectedItemTemplate, suggestion, self.options.multiple\r\n            );\r\n            selectedItem.render();\r\n            self._selectedContainer.append(selectedItem.uiElement);\r\n        }\r\n\r\n        function _lookUpEmptyPrefix() {\r\n            var counter = 0;\r\n            var idx = 0;\r\n            while (counter < self.options.limit && idx < self.suggestions.length) {\r\n                var item = self.suggestions[idx];\r\n                if (isSelected(item)) {\r\n                    idx++;\r\n                    continue;\r\n                }\r\n\r\n                addToMatchedSuggestions(item);\r\n                counter++;\r\n                idx++;\r\n            }\r\n        }\r\n\r\n        function lookup() {\r\n            var counter = 0;\r\n            var idx = 0;\r\n\r\n            var prefix = self.inputElement.val();\r\n\r\n            if (prefix == self._lastVal && prefix !== '') {\r\n                return;\r\n            }\r\n\r\n            self._lastVal = prefix;\r\n            self.matchedSuggestions = [];\r\n            self._matchesSuggestionIds = Object.create(null);\r\n\r\n            if (prefix === '') {\r\n                _lookUpEmptyPrefix();\r\n                return;\r\n            }\r\n\r\n            console.time('lookUp');\r\n            while (counter < self.options.limit && idx < self.suggestions.length) {\r\n                var matchResult = self.matcher(prefix, self.suggestions[idx], self.selectedItems);\r\n                if (matchResult.matched) {\r\n                    self.suggestions[idx].mathedBy = matchResult.matchedBy;\r\n                    addToMatchedSuggestions(self.suggestions[idx]);\r\n                    counter++;\r\n                }\r\n                idx++;\r\n            }\r\n            console.timeEnd('lookUp');\r\n\r\n            if (self.options.serverSide) {\r\n                serverLookUp(prefix);\r\n            }\r\n        }\r\n\r\n\r\n        function appendMatchedSuggestionsFromServer(suggestions) {\r\n            suggestions.forEach(function (suggestion) {\r\n                if (!isSelected(suggestion) && !isInMatchedSuggestions(suggestion)) {\r\n                    addToMatchedSuggestions(suggestion);\r\n                    renderMatchedSuggestion(suggestion);\r\n                }\r\n            });\r\n        }\r\n\r\n        function onServerLookUpLoaded(prefix, response) {\r\n            self._cache[prefix] = response.result;\r\n            if (!self.matchedSuggestions.length) {\r\n                clearMatchedSuggestionsList();\r\n            }\r\n            if (response.result.length) {\r\n                appendMatchedSuggestionsFromServer(response.result);\r\n            } else if (!self.matchedSuggestions.length) {\r\n                showEmptySuggestionMessage();\r\n                self._lastIsEmpty = true;\r\n            }\r\n        }\r\n\r\n        function serverLookUp(prefix) {\r\n            if (prefix == '') {\r\n                return;\r\n            }\r\n            self._serverQuryIsRunning = true;\r\n            var _cached = self._cache[prefix];\r\n            var findParams = {};\r\n\r\n            if (_cached) {\r\n                appendMatchedSuggestionsFromServer(_cached);\r\n                self._serverQuryIsRunning = false;\r\n                return;\r\n            }\r\n\r\n            findParams[self.options.serverSideFindProperty] = prefix;\r\n            findParams['limit'] = self.options.limit;\r\n\r\n            uiDropDownajax({\r\n                method: self.options.serverSideMethod,\r\n                url: self.options.serverSideUrl,\r\n                data: findParams,\r\n                params: findParams,\r\n                onError: function (xrh) {\r\n                    console.log('ERROR', xrh.statusText);\r\n                    if (!self.matchedSuggestions.length) {\r\n                        clearMatchedSuggestionsList();\r\n                        showEmptySuggestionMessage();\r\n                    }\r\n                    self._serverQuryIsRunning = false;\r\n                },\r\n                onSuccess: function (response) {\r\n                    onServerLookUpLoaded(prefix, response);\r\n                    self._serverQuryIsRunning = false;\r\n                }\r\n            });\r\n        }\r\n\r\n        function deBounce(func, wait, immediate) {\r\n            var timeout;\r\n            return function () {\r\n                var context = this, args = arguments;\r\n\r\n                var later = function () {\r\n                    timeout = null;\r\n                    if (!immediate) func.apply(context, args);\r\n                };\r\n\r\n                var callNow = immediate && !timeout;\r\n                clearTimeout(timeout);\r\n                timeout = setTimeout(later, wait);\r\n                if (callNow) {\r\n                    func.apply(context, args);\r\n                }\r\n            };\r\n        }\r\n\r\n        function showEmptySuggestionMessage() {\r\n            var dropDownItem = DropDownSuggestionItem(self.options.emptyMessageTemplate, {name: 'empty'});\r\n            dropDownItem.render();\r\n            self._suggestionsWrapper.append(dropDownItem.uiElement.element);\r\n        }\r\n    }\r\n\r\n    window.UiDropDown = UiDropDown;\r\n})(window);"]}